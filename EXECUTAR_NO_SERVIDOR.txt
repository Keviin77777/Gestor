═══════════════════════════════════════════════════════════════
🚀 COMANDOS PARA EXECUTAR NO SERVIDOR VPS
═══════════════════════════════════════════════════════════════

📍 Conecte-se ao servidor via SSH:
   ssh root@vmi2860321.contaboserver.net

───────────────────────────────────────────────────────────────
PASSO 1: ATUALIZAR CÓDIGO DO GITHUB
───────────────────────────────────────────────────────────────

cd /www/wwwroot/ultragestor.site/Gestor
git pull origin main

───────────────────────────────────────────────────────────────
PASSO 2: EXECUTAR SCRIPTS DE CORREÇÃO
───────────────────────────────────────────────────────────────

# Script 1: Corrigir permissões e storage
bash fix-api-production.sh

# Script 2: Corrigir configuração do Nginx (IMPORTANTE!)
bash fix-nginx-config.sh

Estes scripts vão:
✅ Criar pasta storage/
✅ Corrigir permissões
✅ Testar .env
✅ Verificar putenv()
✅ Corrigir configuração do Nginx
✅ Testar API

───────────────────────────────────────────────────────────────
PASSO 3: HABILITAR putenv() NO PHP
───────────────────────────────────────────────────────────────

Se o script mostrar que putenv() está desabilitado:

1. Acesse o aaPanel: http://seu-ip:7800
2. Vá em: Software → PHP 8.1 → Settings
3. Aba: Disabled Functions
4. Remova "putenv" da lista
5. Clique em Save

Depois reinicie:
systemctl restart php-fpm-81

───────────────────────────────────────────────────────────────
PASSO 4: TESTAR API
───────────────────────────────────────────────────────────────

# Teste 1: API online
curl https://ultragestor.site/api/

# Deve retornar:
# {"message":"IPTV Manager API v1.0","status":"online"}

# Teste 2: Login
curl -X POST https://ultragestor.site/api/auth \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@admin.com","password":"admin123","action":"login"}'

# Deve retornar um token JWT

───────────────────────────────────────────────────────────────
PASSO 5: VERIFICAR LOGS (SE HOUVER ERRO)
───────────────────────────────────────────────────────────────

# Ver últimos erros do Nginx
tail -n 50 /www/wwwlogs/ultragestor.site.error.log

# Ver últimos erros do PHP
tail -n 50 /www/server/php/81/var/log/php-fpm.log

───────────────────────────────────────────────────────────────
📚 DOCUMENTAÇÃO CRIADA
───────────────────────────────────────────────────────────────

1. SOLUCAO_RAPIDA_API.md
   → Solução rápida em 3 passos

2. COMANDOS_CORRIGIR_API.md
   → Guia completo passo a passo

3. CORRIGIR_API_403.md
   → Troubleshooting detalhado

4. fix-api-production.sh
   → Script de correção automática

───────────────────────────────────────────────────────────────
✅ RESULTADO ESPERADO
───────────────────────────────────────────────────────────────

Após executar os comandos, a API deve responder:

$ curl https://ultragestor.site/api/
{"message":"IPTV Manager API v1.0","status":"online"}

$ curl -X POST https://ultragestor.site/api/auth ...
{"success":true,"token":"eyJ0eXAi...","user":{...}}

🎉 API funcionando!

───────────────────────────────────────────────────────────────
🆘 SE PRECISAR DE AJUDA
───────────────────────────────────────────────────────────────

Envie:
1. Saída do: bash fix-api-production.sh
2. Logs: tail -n 50 /www/wwwlogs/ultragestor.site.error.log
3. Teste: curl -v https://ultragestor.site/api/

═══════════════════════════════════════════════════════════════
